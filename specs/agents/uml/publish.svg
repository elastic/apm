<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="272px" preserveAspectRatio="none" style="width:415px;height:272px;background:#FFFFFF;" version="1.1" viewBox="0 0 415 272" width="415px" zoomAndPan="magnify"><defs><filter height="300%" id="f1lc08517lx5ao" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1lc08517lx5ao)" height="22.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="80" y="51.6094"/><rect fill="#FFFFFF" filter="url(#f1lc08517lx5ao)" height="9" style="stroke:#A80036;stroke-width:1.0;" width="10" x="80" y="247.7188"/><rect fill="#00BFB3" filter="url(#f1lc08517lx5ao)" height="205.1094" style="stroke:#A80036;stroke-width:1.0;" width="10" x="213.5" y="51.6094"/><rect fill="#1BA9F5" filter="url(#f1lc08517lx5ao)" height="173.7578" style="stroke:#A80036;stroke-width:1.0;" width="10" x="218.5" y="73.9609"/><rect fill="#FFFFFF" filter="url(#f1lc08517lx5ao)" height="173.7578" style="stroke:#A80036;stroke-width:1.0;" width="10" x="335" y="73.9609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="85" x2="85" y1="41.6094" y2="265.7188"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="218" x2="218" y1="41.6094" y2="265.7188"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="340" x2="340" y1="41.6094" y2="265.7188"/><rect fill="#FEFECE" filter="url(#f1lc08517lx5ao)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="156" x="5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="142" x="12" y="26.5332">Application (Publisher)</text><rect fill="#FEFECE" filter="url(#f1lc08517lx5ao)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="83" x="175" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="182" y="26.5332">APM agent</text><path d="M277,14 L403,14 C408,14 408,27.8047 408,27.8047 C408,27.8047 408,41.6094 403,41.6094 L277,41.6094 C272,41.6094 272,27.8047 272,27.8047 C272,27.8047 272,14 277,14 " fill="#FEFECE" filter="url(#f1lc08517lx5ao)" style="stroke:#A80036;stroke-width:2.0;"/><path d="M403,14 C398,14 398,27.8047 398,27.8047 C398,41.6094 403,41.6094 403,41.6094 " fill="none" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="277" y="33.5332">Messaging system</text><rect fill="#FFFFFF" filter="url(#f1lc08517lx5ao)" height="22.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="80" y="51.6094"/><rect fill="#FFFFFF" filter="url(#f1lc08517lx5ao)" height="9" style="stroke:#A80036;stroke-width:1.0;" width="10" x="80" y="247.7188"/><rect fill="#00BFB3" filter="url(#f1lc08517lx5ao)" height="205.1094" style="stroke:#A80036;stroke-width:1.0;" width="10" x="213.5" y="51.6094"/><rect fill="#1BA9F5" filter="url(#f1lc08517lx5ao)" height="173.7578" style="stroke:#A80036;stroke-width:1.0;" width="10" x="218.5" y="73.9609"/><rect fill="#FFFFFF" filter="url(#f1lc08517lx5ao)" height="173.7578" style="stroke:#A80036;stroke-width:1.0;" width="10" x="335" y="73.9609"/><polygon fill="#A80036" points="323,69.9609,333,73.9609,323,77.9609,327,73.9609" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="85" x2="329" y1="73.9609" y2="73.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="106" x="92" y="69.1045">publish message</text><line style="stroke:#A80036;stroke-width:1.0;" x1="228.5" x2="270.5" y1="104.3125" y2="104.3125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="270.5" x2="270.5" y1="104.3125" y2="117.3125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="229.5" x2="270.5" y1="117.3125" y2="117.3125"/><polygon fill="#A80036" points="239.5,113.3125,229.5,117.3125,239.5,121.3125,235.5,117.3125" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68" x="235.5" y="99.4561">span.Start()</text><path d="M14,130.3125 L14,189.3125 L204,189.3125 L204,140.3125 L194,130.3125 L14,130.3125 " fill="#FBFB77" filter="url(#f1lc08517lx5ao)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M194,130.3125 L194,140.3125 L204,140.3125 L194,130.3125 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="115" x="20" y="148.8076">Capture new span</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="24" y="165.1592"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="20" y="181.5107">There is an active transaction</text><line style="stroke:#A80036;stroke-width:1.0;" x1="228.5" x2="270.5" y1="220.7188" y2="220.7188"/><line style="stroke:#A80036;stroke-width:1.0;" x1="270.5" x2="270.5" y1="220.7188" y2="233.7188"/><line style="stroke:#A80036;stroke-width:1.0;" x1="229.5" x2="270.5" y1="233.7188" y2="233.7188"/><polygon fill="#A80036" points="239.5,229.7188,229.5,233.7188,239.5,237.7188,235.5,233.7188" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="235.5" y="215.8623">span.End()</text><polygon fill="#A80036" points="101,243.7188,91,247.7188,101,251.7188,97,247.7188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="95" x2="339" y1="247.7188" y2="247.7188"/><!--MD5=[20219d14b130c4072fbc1edfdbfa164f]
@startuml publish
hide footbox
participant "Application (Publisher)" as app
participant "APM agent" as apm
queue       "Messaging system" as queue

    activate app
    activate apm #00BFB3
    app -> queue: **publish message**
    deactivate app  
    activate queue
    activate apm #1BA9F5
    apm -> apm: span.Start()
    note left of apm
        **Capture new span**

        There is an active transaction
    end note   
    apm -> apm: span.End()
    queue - -> app
    deactivate queue
    activate app
    deactivate apm

@enduml

PlantUML version 1.2021.7(Sun May 23 22:40:07 AEST 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: AU
--></g></svg>